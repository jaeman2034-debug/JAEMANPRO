import { useState, useEffect, useRef } from 'react'
import { Link, useNavigate, useLocation } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { normalizeEmailInput, normalizeEmailId, isValidEmail } from '../../utils/emailNormalizer'

// ìŒì„± í›…ë“¤ì„ ì•ˆì „í•˜ê²Œ import
import { useSpeechRecognition } from '../../hooks/useSpeechRecognition'
import { useSpeechSynthesis } from '../../hooks/useSpeechSynthesis'

const Register = () => {
  const location = useLocation();
  const selectedCountryDomain = location.state?.selectedDomain;
  const countryName = location.state?.domainName;
  
  const [email, setEmail] = useState('')
  const [emailId, setEmailId] = useState('') // ì´ë©”ì¼ ID ë¶€ë¶„
  const [selectedDomain, setSelectedDomain] = useState('@gmail.com') // ì„ íƒëœ ë„ë©”ì¸
  const [showDomainDropdown, setShowDomainDropdown] = useState(false) // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ í‘œì‹œ ì—¬ë¶€
  const [password, setPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')
  const [lastProcessedText, setLastProcessedText] = useState('') // ë§ˆì§€ë§‰ ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ (ì¤‘ë³µ ë°©ì§€)
  const lastProcessedTime = useRef<number>(0) // ë§ˆì§€ë§‰ ì²˜ë¦¬ ì‹œê°„ (ì¤‘ë³µ ë°©ì§€)
  const [inputMode, setInputMode] = useState<'email' | 'password' | 'confirmPassword'>('email') // ì…ë ¥ ëª¨ë“œ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸/í™•ì¸ë¹„ë°€ë²ˆí˜¸)
  const [passwordMode, setPasswordMode] = useState(false) // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë“œ
  const [voiceError, setVoiceError] = useState(false)
  const [showPassword, setShowPassword] = useState(false) // ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ ì—¬ë¶€
  const [showConfirmPassword, setShowConfirmPassword] = useState(false) // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë…¸ì¶œ ì—¬ë¶€
  
  // ì…ë ¥ì°½ refë“¤
  const emailIdRef = useRef<HTMLInputElement>(null)
  const passwordRef = useRef<HTMLInputElement>(null)
  const confirmPasswordRef = useRef<HTMLInputElement>(null)
  
  const { register, loginWithGoogle } = useAuth()
  const navigate = useNavigate()
  
  // ë„ë©”ì¸ ëª©ë¡
  const domains = [
    '@gmail.com',
    '@naver.com', 
    '@daum.net',
    '@yahoo.com',
    '@hotmail.com',
    '@outlook.com'
  ]
  
  // ìŒì„± ì¸ì‹ ë° TTS í›…
  const { transcript, isListening, startListening, stopListening, resetTranscript, error: speechError } = useSpeechRecognition()
  const { speak } = useSpeechSynthesis()

  // ìŒì„± ì¸ì‹ ìƒíƒœ ë””ë²„ê¹… ë° voiceError ì„¤ì •
  useEffect(() => {
    console.log('ğŸ¤ ìŒì„± ì¸ì‹ ìƒíƒœ ë³€ê²½:', {
      isListening,
      transcript,
      speechError
    });
    
    // ìŒì„± ì¸ì‹ ì—ëŸ¬ê°€ ìˆìœ¼ë©´ voiceError ì„¤ì •
    if (speechError) {
      setVoiceError(true);
      console.log('ğŸ¤ voiceError ì„¤ì •ë¨ (speechError):', true);
    } else {
      setVoiceError(false);
      console.log('ğŸ¤ voiceError ì„¤ì •ë¨ (speechError):', false);
    }
  }, [isListening, transcript, speechError]);

  // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ ìƒíƒœ ë””ë²„ê¹…
  useEffect(() => {
    console.log('ğŸŒ showDomainDropdown ìƒíƒœ ë³€ê²½:', showDomainDropdown);
  }, [showDomainDropdown]);

  // ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬ (processVoiceCommand í•¨ìˆ˜ ì •ì˜ í›„ì— ì¶”ê°€ë¨)

  // ì´ë©”ì¼ IDì™€ ë„ë©”ì¸ ê²°í•©
  useEffect(() => {
    const fullEmail = emailId + selectedDomain
    setEmail(fullEmail)
    console.log('ğŸ“§ ì™„ì „í•œ ì´ë©”ì¼ ìƒì„±:', fullEmail)
    console.log('ğŸ“§ emailId:', emailId)
    console.log('ğŸ“§ selectedDomain:', selectedDomain)
  }, [emailId, selectedDomain])

  // íšŒì›ê°€ì… ì œì¶œ ì²˜ë¦¬ í•¨ìˆ˜
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setError('')

    if (password !== confirmPassword) {
      setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')
      setLoading(false)
      return
    }

    const result = await register(email, password)
    if (result.success) {
      navigate('/home')
    } else {
      // Firebase ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í•œêµ­ì–´ë¡œ ë³€í™˜
      let koreanError = result.error
      
      if (result.error.includes('Password should be at least 6 characters')) {
        koreanError = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/weak-password')) {
        koreanError = 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. ë” ê°•í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.'
      } else if (result.error.includes('auth/email-already-in-use')) {
        koreanError = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/invalid-email')) {
        koreanError = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/network-request-failed')) {
        koreanError = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'
      } else if (result.error.includes('auth/too-many-requests')) {
        koreanError = 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
      } else if (result.error.includes('auth/user-disabled')) {
        koreanError = 'ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/operation-not-allowed')) {
        koreanError = 'í—ˆìš©ë˜ì§€ ì•Šì€ ì‘ì—…ì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/invalid-password')) {
        koreanError = 'ìœ íš¨í•˜ì§€ ì•Šì€ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/user-not-found')) {
        koreanError = 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      } else if (result.error.includes('auth/wrong-password')) {
        koreanError = 'ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/account-exists-with-different-credential')) {
        koreanError = 'ë‹¤ë¥¸ ì¸ì¦ ë°©ë²•ìœ¼ë¡œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/requires-recent-login')) {
        koreanError = 'ìµœê·¼ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'
      } else if (result.error.includes('auth/credential-already-in-use')) {
        koreanError = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì¸ì¦ ì •ë³´ì…ë‹ˆë‹¤.'
      }
      
      setError(koreanError)
    }
    setLoading(false)
  }

  // ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ë° STT ì‹œì‘ í•¨ìˆ˜
  const focusAndStartSTT = (ref: React.RefObject<HTMLInputElement>, message: string) => {
    if (voiceError) {
      alert('ìŒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    console.log('ğŸ¯ focusAndStartSTT í˜¸ì¶œë¨')
    console.log('ğŸ¯ ref ê°ì²´:', ref)
    console.log('ğŸ¯ ref.current:', ref.current)
    
    if (ref.current) {
      ref.current.focus()
      ref.current.select() // ê¸°ì¡´ í…ìŠ¤íŠ¸ ì„ íƒ
      console.log('ğŸ¯ ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì´ë™ ì„±ê³µ:', ref.current.id)
    } else {
      console.error('ğŸ¯ ref.currentê°€ nullì…ë‹ˆë‹¤!')
    }
    
    // TTS ì¤‘ë³µ ë°©ì§€ ë° ìµœì†Œí™”
    const currentTime = Date.now();
    if (lastProcessedTime.current && currentTime - lastProcessedTime.current < 1000) {
      console.log('ğŸ”„ TTS ì¤‘ë³µ ë°©ì§€:', message);
      return;
    }
    lastProcessedTime.current = currentTime;
    
    if (!isListening) {
      console.log('ğŸ¯ TTS ë©”ì‹œì§€:', message)
      speak(message)
    } else {
      console.log('ğŸ¯ ìŒì„± ì¸ì‹ ì¤‘ - TTS ìƒëµ')
    }
    
    // STT ì‹œì‘ (ì¦‰ì‹œ ì‹œì‘, ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”)
    if (isListening && stopListening) {
      console.log('ğŸ¯ ê¸°ì¡´ ìŒì„± ì¸ì‹ ì¤‘ì§€')
      stopListening()
    }
    
    // ì¦‰ì‹œ ìƒˆë¡œìš´ ìŒì„± ì¸ì‹ ì‹œì‘
    setTimeout(() => {
      console.log('ğŸ¯ ìƒˆë¡œìš´ ìŒì„± ì¸ì‹ ì‹œì‘')
      if (startListening && !isListening) {
        startListening()
        console.log('ğŸ¤ STT ì‹œì‘ë¨')
      } else if (isListening) {
        console.log('ğŸ¯ ì´ë¯¸ ìŒì„± ì¸ì‹ ì¤‘')
      } else {
        console.log('ğŸ¯ ìŒì„± ì¸ì‹ ì‹œì‘ ì¡°ê±´ ë¶ˆì¶©ì¡±')
      }
    }, 300) // 300msë¡œ ë” ë‹¨ì¶•
  }

  // ìŒì„± ëª…ë ¹ ì²˜ë¦¬ í•¨ìˆ˜
  const processVoiceCommand = (transcript: string) => {
    if (voiceError) return false;

    const lowerTranscript = transcript.toLowerCase().trim()
    console.log('ğŸ¤ ìŒì„± ëª…ë ¹ ì²˜ë¦¬ ì‹œì‘:', lowerTranscript)
    console.log('ğŸ¤ ì „ì²´ transcript:', transcript)
    
    // í•œêµ­ì–´/ì˜ì–´ í˜¼í•© í…ìŠ¤íŠ¸ì—ì„œ ëª…ë ¹ì–´ ì¶”ì¶œ
    const extractCommands = (text: string) => {
      const commands = []
      const lowerText = text.toLowerCase();
      
      // ë„ë©”ì¸ ëª…ë ¹ì–´ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì²˜ë¦¬ (ë‹¨ìˆœí•˜ê³  í™•ì‹¤í•œ ë§¤ì¹­)
      if (lowerText.includes('gmail') || lowerText.includes('ì§€ë©”ì¼') || lowerText.includes('êµ¬ê¸€')) {
        commands.unshift('gmail');
        console.log('ğŸ” Gmail ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€:', text);
      }
      
      if (lowerText.includes('naver') || lowerText.includes('ë„¤ì´ë²„') || lowerText.includes('ë„¤ë²„')) {
        commands.unshift('naver');
        console.log('ğŸ” Naver ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€:', text);
      }
      
      if (lowerText.includes('daum') || lowerText.includes('ë‹¤ìŒ')) {
        commands.unshift('daum');
        console.log('ğŸ” Daum ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€:', text);
      }
      
      if (lowerText.includes('yahoo') || lowerText.includes('ì•¼í›„') || lowerText.includes('ì•¼í˜¸')) {
        commands.unshift('yahoo');
        console.log('ğŸ” Yahoo ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€:', text);
      }
      
      if (lowerText.includes('hanmail') || lowerText.includes('í•œë©”ì¼')) {
        commands.unshift('hanmail');
        console.log('ğŸ” Hanmail ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€:', text);
      }
      
      // ë„ë©”ì¸ ëª…ë ¹ì–´ê°€ ê°ì§€ë˜ë©´ ì¦‰ì‹œ ë°˜í™˜
      if (commands.length > 0) {
        console.log('ğŸŒ ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€ë¨ - ì¦‰ì‹œ ë°˜í™˜:', commands);
        return commands;
      }
      
      // ì¼ë°˜ ëª…ë ¹ì–´ë“¤
      if (!showDomainDropdown && (lowerText.includes('ì´ë©”ì¼') || lowerText.includes('email') || lowerText.includes('ì•„ì´ë””') || lowerText.includes('id'))) {
        commands.push('ì´ë©”ì¼')
      }
      
      if (lowerText.includes('ë¹„ë°€ë²ˆí˜¸') || lowerText.includes('password') || lowerText.includes('ë¹„ë²ˆ')) {
        commands.push('ë¹„ë°€ë²ˆí˜¸')
      }
      
      if (lowerText.includes('í™•ì¸') || lowerText.includes('confirm')) {
        commands.push('í™•ì¸')
      }
      
      if (lowerText.includes('ë„ë©”ì¸') || lowerText.includes('domain') || lowerText.includes('ë©”ì¸') || lowerText.includes('ë©”ì¼')) {
        commands.push('ë„ë©”ì¸')
      }
      
      if (lowerText.includes('ë‹¤ìŒ') || lowerText.includes('next')) {
        commands.push('ë‹¤ìŒ')
      }
      
      if (lowerText.includes('ì™„ë£Œ') || lowerText.includes('complete') || lowerText.includes('finish')) {
        commands.push('ì™„ë£Œ')
      }
      
      if (lowerText.includes('ë‹¤ì‹œ') || lowerText.includes('reset') || lowerText.includes('clear')) {
        commands.push('ë‹¤ì‹œ')
      }
      
      if (lowerText.includes('ë„ì›€ë§') || lowerText.includes('help')) {
        commands.push('ë„ì›€ë§')
      }
      
      if (lowerText.includes('ê°€ì…') || lowerText.includes('register') || lowerText.includes('signup')) {
        commands.push('ê°€ì…')
      }
      
      if (lowerText.includes('ì·¨ì†Œ') || lowerText.includes('cancel')) {
        commands.push('ì·¨ì†Œ')
      }
      
      return commands
    }
    
    const foundCommands = extractCommands(lowerTranscript)
    console.log('ğŸ” ë°œê²¬ëœ ëª…ë ¹ì–´ë“¤:', foundCommands)
    console.log('ğŸ” ëª…ë ¹ì–´ ê°œìˆ˜:', foundCommands.length)
    
    // ëª…ë ¹ì–´ ì²˜ë¦¬ ì¤€ë¹„
    if (foundCommands.length === 0) {
      console.log('âŒ ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
      return false;
    }

    const command = foundCommands[0];
    const isDomainCommand = ['gmail', 'naver', 'daum', 'yahoo', 'hanmail'].includes(command);
    
    console.log('ğŸ¯ ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œì‘:', command, 'ë„ë©”ì¸ ëª…ë ¹ì–´:', isDomainCommand);
    
    // ë„ë©”ì¸ ëª…ë ¹ì–´ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¤‘ë³µ ë°©ì§€ ì ìš©
    if (!isDomainCommand) {
      if (lastProcessedText === command) {
        console.log('ğŸ”„ ëª…ë ¹ì–´ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€:', command);
        return true;
      }
      setLastProcessedText(command);
    } else {
      // ë„ë©”ì¸ ëª…ë ¹ì–´ëŠ” í•­ìƒ ì²˜ë¦¬
      setLastProcessedText('');
    }
    
    // ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œì‘
    console.log('ğŸ¯ ì²˜ë¦¬í•  ëª…ë ¹ì–´:', command)
    console.log('ğŸ¯ ì „ì²´ ëª…ë ¹ì–´ ëª©ë¡:', foundCommands)
      
      // ëª…ë ¹ì–´ë³„ ì²˜ë¦¬
      switch (command) {
        case 'ì´ë©”ì¼':
          setShowDomainDropdown(false) // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          console.log('ğŸ“§ ì´ë©”ì¼ ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œì‘')
          console.log('ğŸ“§ emailIdRef:', emailIdRef)
          console.log('ğŸ“§ emailIdRef.current:', emailIdRef.current)
          setInputMode('email')
          setPasswordMode(false)
          focusAndStartSTT(emailIdRef, 'ì´ë©”ì¼ ID ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. IDë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
          console.log('ğŸ“§ ì´ë©”ì¼ ID ì…ë ¥ ëª¨ë“œ ì„¤ì • ì™„ë£Œ')
          return true
          
        case 'ë¹„ë°€ë²ˆí˜¸':
          setShowDomainDropdown(false) // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          setPasswordMode(true)
          setInputMode('password')
          focusAndStartSTT(passwordRef, 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
          console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë“œ')
          return true
          
        case 'í™•ì¸':
          if (passwordMode) {
            setPasswordMode(false)
            setInputMode('confirmPassword')
            focusAndStartSTT(confirmPasswordRef, 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
            console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ ëª¨ë“œ')
          } else {
            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ
            speak('ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
            console.log('âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ')
          }
          return true
          
        case 'ë„ë©”ì¸':
          console.log('ğŸŒ ë„ë©”ì¸ ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œì‘');
          console.log('ğŸŒ í˜„ì¬ showDomainDropdown:', showDomainDropdown);
          setShowDomainDropdown(true) // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ ì—´ê¸°
          console.log('ğŸŒ showDomainDropdownì„ trueë¡œ ì„¤ì •');
          
          // TTS ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ setTimeout ì‚¬ìš©
          setTimeout(() => {
            speak('ë„ë©”ì¸ ì„ íƒ ì°½ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. gmail, naver, daum ì¤‘ ì›í•˜ëŠ” ë„ë©”ì¸ì„ ë§ì”€í•´ì£¼ì„¸ìš”.')
          }, 100);
          
          console.log('ğŸŒ ë„ë©”ì¸ ì„ íƒ ëª¨ë“œ - ë“œë¡­ë‹¤ìš´ ì—´ë¦¼')
          return true
          
        case 'gmail':
          // ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
          if (isListening && stopListening) {
            console.log('ğŸ¤ Gmail ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
            stopListening();
          }
          
          setSelectedDomain('@gmail.com')
          setShowDomainDropdown(false) // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          
          // ì´ë©”ì¼ ID ì´ˆê¸°í™” (ëˆ„ì ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ ì œê±°)
          setEmailId('jaeman2034'); // ì›ë˜ IDë§Œ ìœ ì§€
          console.log('ğŸ”„ Gmail ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ ì´ë©”ì¼ ID ì´ˆê¸°í™”');
          
          // transcript ì´ˆê¸°í™”
          if (resetTranscript) {
            resetTranscript();
            console.log('ğŸ”„ Gmail ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ transcript ì´ˆê¸°í™”');
          }
          
          speak('Gmail ë„ë©”ì¸ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
            setTimeout(() => {
              if (startListening) {
                startListening();
                console.log('ğŸ¤ TTS ì™„ë£Œ í›„ ìŒì„± ì¸ì‹ ì¬ì‹œì‘');
              }
            }, 1000);
          });
          console.log('ğŸ¯ Gmail ë„ë©”ì¸ ì„ íƒë¨')
          
          // ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ:', selectedDomain)
          console.log('ğŸ” í˜„ì¬ ì´ë©”ì¼ ID:', emailId)
          
          setLastProcessedText('')
          return true
          
        case 'naver':
          // ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
          if (isListening && stopListening) {
            console.log('ğŸ¤ Naver ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
            stopListening();
          }
          
          setSelectedDomain('@naver.com')
          setShowDomainDropdown(false) // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          
          // ì´ë©”ì¼ ID ì´ˆê¸°í™” (ëˆ„ì ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ ì œê±°)
          setEmailId('jaeman2034'); // ì›ë˜ IDë§Œ ìœ ì§€
          console.log('ğŸ”„ Naver ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ ì´ë©”ì¼ ID ì´ˆê¸°í™”');
          
          // transcript ì´ˆê¸°í™”
          if (resetTranscript) {
            resetTranscript();
            console.log('ğŸ”„ Naver ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ transcript ì´ˆê¸°í™”');
          }
          
          speak('Naver ë„ë©”ì¸ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
            setTimeout(() => {
              if (startListening) {
                startListening();
                console.log('ğŸ¤ TTS ì™„ë£Œ í›„ ìŒì„± ì¸ì‹ ì¬ì‹œì‘');
              }
            }, 1000);
          });
          console.log('ğŸ¯ Naver ë„ë©”ì¸ ì„ íƒë¨')
          
          // ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ:', selectedDomain)
          console.log('ğŸ” í˜„ì¬ ì´ë©”ì¼ ID:', emailId)
          
          setLastProcessedText('')
          return true
          
        case 'daum':
          // ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
          if (isListening && stopListening) {
            console.log('ğŸ¤ Daum ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
            stopListening();
          }
          
          setSelectedDomain('@daum.net')
          setShowDomainDropdown(false) // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          
          // ì´ë©”ì¼ ID ì´ˆê¸°í™” (ëˆ„ì ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ ì œê±°)
          setEmailId('jaeman2034'); // ì›ë˜ IDë§Œ ìœ ì§€
          console.log('ğŸ”„ Daum ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ ì´ë©”ì¼ ID ì´ˆê¸°í™”');
          
          // transcript ì´ˆê¸°í™”
          if (resetTranscript) {
            resetTranscript();
            console.log('ğŸ”„ Daum ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ transcript ì´ˆê¸°í™”');
          }
          
          speak('Daum ë„ë©”ì¸ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
            setTimeout(() => {
              if (startListening) {
                startListening();
                console.log('ğŸ¤ TTS ì™„ë£Œ í›„ ìŒì„± ì¸ì‹ ì¬ì‹œì‘');
              }
            }, 1000);
          });
          console.log('ğŸ¯ Daum ë„ë©”ì¸ ì„ íƒë¨')
          
          // ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ:', selectedDomain)
          console.log('ğŸ” í˜„ì¬ ì´ë©”ì¼ ID:', emailId)
          
          setLastProcessedText('')
          return true
          
        case 'yahoo':
          // ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
          if (isListening && stopListening) {
            console.log('ğŸ¤ Yahoo ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
            stopListening();
          }
          
          setSelectedDomain('@yahoo.com')
          setShowDomainDropdown(false) // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          
          // ì´ë©”ì¼ ID ì´ˆê¸°í™” (ëˆ„ì ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ ì œê±°)
          setEmailId('jaeman2034'); // ì›ë˜ IDë§Œ ìœ ì§€
          console.log('ğŸ”„ Yahoo ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ ì´ë©”ì¼ ID ì´ˆê¸°í™”');
          
          // transcript ì´ˆê¸°í™”
          if (resetTranscript) {
            resetTranscript();
            console.log('ğŸ”„ Yahoo ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ transcript ì´ˆê¸°í™”');
          }
          
          speak('Yahoo ë„ë©”ì¸ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
            setTimeout(() => {
              if (startListening) {
                startListening();
                console.log('ğŸ¤ TTS ì™„ë£Œ í›„ ìŒì„± ì¸ì‹ ì¬ì‹œì‘');
              }
            }, 1000);
          });
          console.log('ğŸ¯ Yahoo ë„ë©”ì¸ ì„ íƒë¨')
          
          // ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ:', selectedDomain)
          console.log('ğŸ” í˜„ì¬ ì´ë©”ì¼ ID:', emailId)
          
          setLastProcessedText('')
          return true
          
        case 'hanmail':
          // ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
          if (isListening && stopListening) {
            console.log('ğŸ¤ Hanmail ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
            stopListening();
          }
          
          setSelectedDomain('@hanmail.net')
          setShowDomainDropdown(false) // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          
          // ì´ë©”ì¼ ID ì´ˆê¸°í™” (ëˆ„ì ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ ì œê±°)
          setEmailId('jaeman2034'); // ì›ë˜ IDë§Œ ìœ ì§€
          console.log('ğŸ”„ Hanmail ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ ì´ë©”ì¼ ID ì´ˆê¸°í™”');
          
          // transcript ì´ˆê¸°í™”
          if (resetTranscript) {
            resetTranscript();
            console.log('ğŸ”„ Hanmail ëª…ë ¹ì–´ ì²˜ë¦¬ í›„ transcript ì´ˆê¸°í™”');
          }
          
          speak('Hanmail ë„ë©”ì¸ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.', () => {
            setTimeout(() => {
              if (startListening) {
                startListening();
                console.log('ğŸ¤ TTS ì™„ë£Œ í›„ ìŒì„± ì¸ì‹ ì¬ì‹œì‘');
              }
            }, 1000);
          });
          console.log('ğŸ¯ Hanmail ë„ë©”ì¸ ì„ íƒë¨')
          
          // ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ:', selectedDomain)
          console.log('ğŸ” í˜„ì¬ ì´ë©”ì¼ ID:', emailId)
          
          setLastProcessedText('')
          return true
          
        case 'ì™„ë£Œ':
          speak('ì…ë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
          console.log('âœ… ì…ë ¥ ì™„ë£Œ')
          return true
          
        case 'ë‹¤ì‹œ':
          setEmailId('')
          setPassword('')
          setConfirmPassword('')
          setLastProcessedText('')
          setEmail('')
          setInputMode('email')
          setPasswordMode(false)
          speak('ì…ë ¥ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.')
          console.log('ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”')
          return true
          
        case 'ë„ì›€ë§':
          speak('ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, í™•ì¸ ë“±ì˜ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ê° ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')
          console.log('â“ ë„ì›€ë§ ì•ˆë‚´')
          return true
          
        case 'ë‹¤ìŒ':
          if (inputMode === 'email' && emailId) {
            setInputMode('password')
            setPasswordMode(true)
            // ê°„ë‹¨í•œ ì•ˆë‚´ë§Œ í•˜ê³  ì¦‰ì‹œ ì´ë™
            focusAndStartSTT(passwordRef, 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.')
            console.log('ğŸ” ì´ë©”ì¼ â†’ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™')
          } else if (inputMode === 'password' && passwordMode && password) {
            setPasswordMode(false)
            // ê°„ë‹¨í•œ ì•ˆë‚´ë§Œ í•˜ê³  ì¦‰ì‹œ ì´ë™
            focusAndStartSTT(confirmPasswordRef, 'í™•ì¸ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.')
            console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ â†’ í™•ì¸ ëª¨ë“œë¡œ ì´ë™')
          } else {
            // ì¡°ê±´ ë¶ˆì¶©ì¡± ì‹œ ê°„ë‹¨í•œ ì•ˆë‚´ë§Œ
            if (!isListening) {
              speak('ì •ë³´ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.')
            }
            console.log('âš ï¸ í˜„ì¬ ë‹¨ê³„ ì •ë³´ ëˆ„ë½')
          }
          return true
          
        case 'ê°€ì…':
          // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
          if (lastProcessedText === 'ê°€ì…') {
            console.log('ğŸ”„ ê°€ì… ëª…ë ¹ì–´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
            return true;
          }
          setLastProcessedText('ê°€ì…');
          
          if (email && password && confirmPassword) {
            speak('íšŒì›ê°€ì…ì„ ì§„í–‰í•©ë‹ˆë‹¤.')
            console.log('ğŸš€ íšŒì›ê°€ì… ì§„í–‰')
            const submitEvent = new Event('submit') as any
            handleSubmit(submitEvent)
          } else {
            speak('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.')
            console.log('âš ï¸ í•„ìˆ˜ ì •ë³´ ëˆ„ë½')
          }
          return true
          
        case 'ì·¨ì†Œ':
          speak('íšŒì›ê°€ì…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')
          console.log('âŒ íšŒì›ê°€ì… ì·¨ì†Œ')
          return true
      }
    }
    
    console.log('âŒ ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ')
    return false
  }

  // ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬
  useEffect(() => {
    if (voiceError || !transcript) {
      return;
    }

    // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ (ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” ë” ì—„ê²©í•˜ê²Œ)
    const currentTime = Date.now();
    const timeThreshold = isListening ? 2000 : 1000; // ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” 2ì´ˆ, ì•„ë‹ ë•ŒëŠ” 1ì´ˆ
    
    if (lastProcessedTime.current && currentTime - lastProcessedTime.current < timeThreshold) {
      console.log('ğŸ”„ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€:', transcript, `(${timeThreshold}ms)`);
      return;
    }
    lastProcessedTime.current = currentTime;

    console.log('ğŸ¤ ìŒì„± ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬:', transcript)
    console.log('ğŸ¤ í˜„ì¬ isListening:', isListening)
    console.log('ğŸ¤ í˜„ì¬ voiceError:', voiceError)
    console.log('ğŸ¤ í˜„ì¬ inputMode:', inputMode)
    console.log('ğŸ¤ í˜„ì¬ passwordMode:', passwordMode)
    
    // ë¨¼ì € ìŒì„± ëª…ë ¹ ì²˜ë¦¬ (í•œêµ­ì–´/ì˜ì–´ í˜¼í•© í…ìŠ¤íŠ¸ì—ì„œ ëª…ë ¹ì–´ ì¶”ì¶œ)
    const commandFound = processVoiceCommand(transcript)
    if (commandFound) {
      console.log('âœ… ìŒì„± ëª…ë ¹ ì²˜ë¦¬ ì™„ë£Œ')
      resetTranscript()
      return
    }
    
              // ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” ëª¨ë“  ì²˜ë¦¬ ì™„ì „ ì°¨ë‹¨
    if (isListening) {
      console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì¤‘ - ëª¨ë“  ì²˜ë¦¬ ì™„ì „ ì°¨ë‹¨');
      console.log('ğŸ¤ í˜„ì¬ transcript:', transcript);
      console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì¤‘ë‹¨ - transcript ì²˜ë¦¬ ê±´ë„ˆëœ€');
      console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì¤‘ë‹¨ - ì´ë©”ì¼ ID ì…ë ¥ ì²˜ë¦¬ ê±´ë„ˆëœ€');
      return;
    }
    
    // ë„ë©”ì¸ ëª…ë ¹ì–´ê°€ í¬í•¨ëœ ê²½ìš° ì¶”ê°€ í™•ì¸
    const domainRegex = /\b(gmail|naver|daum|ì§€ë©”ì¼|ë„¤ì´ë²„|ë‹¤ìŒ|êµ¬ê¸€|yahoo)\b/i;
    const hasDomainCommand = domainRegex.test(transcript);
    
    if (hasDomainCommand) {
      console.log('ğŸŒ ë„ë©”ì¸ ëª…ë ¹ì–´ ì¬ê°ì§€ - ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ì¬ì‹œë„:', transcript);
      console.log('ğŸŒ í˜„ì¬ lastProcessedText:', lastProcessedText);
      console.log('ğŸŒ ê°ì§€ëœ ë„ë©”ì¸ ëª…ë ¹ì–´:', transcript.match(domainRegex));
      
      // lastProcessedText ì´ˆê¸°í™” í›„ ì¬ì‹œë„
      setLastProcessedText('');
      
      // ë„ë©”ì¸ ëª…ë ¹ì–´ê°€ ìˆìœ¼ë©´ ë‹¤ì‹œ ëª…ë ¹ì–´ ì²˜ë¦¬ ì‹œë„
      const retryCommandFound = processVoiceCommand(transcript);
      if (retryCommandFound) {
        console.log('âœ… ë„ë©”ì¸ ëª…ë ¹ì–´ ì¬ì²˜ë¦¬ ì™„ë£Œ');
        resetTranscript();
        return;
      } else {
        console.log('âŒ ë„ë©”ì¸ ëª…ë ¹ì–´ ì¬ì²˜ë¦¬ ì‹¤íŒ¨');
      }
    }
    
    // ëª…ë ¹ì´ ì•„ë‹Œ ê²½ìš° í˜„ì¬ í™œì„±í™”ëœ ì…ë ¥ì°½ì— ë”°ë¼ ì²˜ë¦¬
    if (inputMode === 'email') {
      // ë„ë©”ì¸ ì„ íƒ ëª¨ë“œ ì¤‘ì´ë©´ ë„ë©”ì¸ ëª…ë ¹ìœ¼ë¡œ ì²˜ë¦¬
      if (showDomainDropdown) {
        console.log('ğŸŒ ë„ë©”ì¸ ì„ íƒ ëª¨ë“œ - ì¼ë°˜ í…ìŠ¤íŠ¸ë¥¼ ë„ë©”ì¸ ëª…ë ¹ìœ¼ë¡œ ì²˜ë¦¬')
        return; // ëª…ë ¹ì–´ ì²˜ë¦¬ë¡œ ë„˜ì–´ê°€ë„ë¡
      }
      
      // ì´ë©”ì¼ ID ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬ (ë„ë©”ì¸ í‚¤ì›Œë“œ ì™„ì „ ì°¨ë‹¨)
      const domainKeywords = [
        // ì˜ì–´ ë„ë©”ì¸
        'gmail', 'naver', 'daum', 'yahoo', 'hanmail',
        // í•œêµ­ì–´ ë„ë©”ì¸ (ì •í™•í•œ ë°œìŒ)
        'ì§€ë©”ì¼', 'ë„¤ì´ë²„', 'ë‹¤ìŒ', 'êµ¬ê¸€', 'ì•¼í›„', 'í•œë©”ì¼',
        // í•œêµ­ì–´ ë°œìŒ ë³€í˜• (ìŒì„± ì¸ì‹ ì˜¤ë¥˜ ëŒ€ì‘)
        'ì§€ë©”', 'ë©”ì¼', 'ë„¤ë²„', 'ë„¤ì´', 'ë‹¤ìŒë©”ì¼',
        'ì•¼í˜¸', 'ì–‘í˜¸', 'ì•¼í›„',
        'ë ˆë²„', 'ë ˆë¹„', 'ë„¤ë¹„', 'ë„¤ë¸Œ',
        'ì§€ë°€', 'ì§€ë©”ì´', 'ì§€ë©”ì¼',
        'ë‹¤ìŒë©”', 'ë‹¤ìŒë©”ì¼', 'ë‹¤ìŒë©”ì¼',
        'í•œë©”', 'í•œë©”ì¼', 'í•œë©”ì¼ë„·'
      ];
      
      // ì •ê·œì‹ìœ¼ë¡œ ì •í™•í•œ ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€ (í™•ì¥ëœ íŒ¨í„´)
      const domainRegex = /\b(gmail|naver|daum|yahoo|hanmail|ì§€ë©”ì¼|ë„¤ì´ë²„|ë‹¤ìŒ|êµ¬ê¸€|ì•¼í›„|í•œë©”ì¼|ì§€ë©”|ë©”ì¼|ë„¤ë²„|ë„¤ì´|ë‹¤ìŒë©”ì¼|ì•¼í˜¸|ì–‘í˜¸|ë ˆë²„|ë ˆë¹„|ë„¤ë¹„|ë„¤ë¸Œ|ì§€ë°€|ì§€ë©”ì´|ë‹¤ìŒë©”|í•œë©”|í•œë©”ì¼ë„·)\b/i;
      const hasDomainCommand = domainRegex.test(transcript);
      
      if (hasDomainCommand) {
        console.log('ğŸŒ ë„ë©”ì¸ ëª…ë ¹ì–´ ê°ì§€ë¨ - ì´ë©”ì¼ ID ì…ë ¥ ì™„ì „ ì°¨ë‹¨:', transcript);
        console.log('ğŸŒ ì°¨ë‹¨ëœ ë„ë©”ì¸ ëª…ë ¹ì–´:', transcript.match(domainRegex));
        return; // ë„ë©”ì¸ ëª…ë ¹ì–´ê°€ ìˆìœ¼ë©´ ì´ë©”ì¼ ID ì…ë ¥ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
      }
      
      // ì¶”ê°€ ê²€ì¦: ë„ë©”ì¸ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš° ì™„ì „ ì°¨ë‹¨
      const hasAnyDomainKeyword = domainKeywords.some(keyword => 
        transcript.toLowerCase().includes(keyword.toLowerCase())
      );
      
      if (hasAnyDomainKeyword) {
        console.log('ğŸŒ ë„ë©”ì¸ í‚¤ì›Œë“œ ê°ì§€ë¨ - ì´ë©”ì¼ ID ì…ë ¥ ì™„ì „ ì°¨ë‹¨:', transcript);
        console.log('ğŸŒ ì°¨ë‹¨ëœ ë„ë©”ì¸ í‚¤ì›Œë“œ:', domainKeywords.filter(keyword => 
          transcript.toLowerCase().includes(keyword.toLowerCase())
        ));
        
        // ë„ë©”ì¸ í‚¤ì›Œë“œê°€ ê°ì§€ë˜ë©´ ì¦‰ì‹œ ìŒì„± ì¸ì‹ ì¤‘ì§€
        if (isListening && stopListening) {
          console.log('ğŸ¤ ë„ë©”ì¸ í‚¤ì›Œë“œ ê°ì§€ë¡œ ìŒì„± ì¸ì‹ ì¦‰ì‹œ ì¤‘ì§€');
          stopListening();
        }
        
        // transcript ì¦‰ì‹œ ì´ˆê¸°í™”
        if (resetTranscript) {
          resetTranscript();
          console.log('ğŸ”„ ë„ë©”ì¸ í‚¤ì›Œë“œ ê°ì§€ í›„ transcript ì¦‰ì‹œ ì´ˆê¸°í™”');
        }
        
        // ë„ë©”ì¸ í‚¤ì›Œë“œê°€ í¬í•¨ëœ transcriptëŠ” ì™„ì „íˆ ë¬´ì‹œ
        console.log('ğŸŒ ë„ë©”ì¸ í‚¤ì›Œë“œ í¬í•¨ transcript ì™„ì „ ë¬´ì‹œ:', transcript);
        return; // ë„ë©”ì¸ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ ì´ë©”ì¼ ID ì…ë ¥ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
      }
      
      const normalizedText = normalizeEmailId(transcript)
      if (normalizedText && normalizedText.trim()) {
        setEmailId(normalizedText)
        // ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” TTS ìµœì†Œí™” (ì…ë ¥ í™•ì¸ë§Œ)
        if (!isListening) {
          speak(`ì´ë©”ì¼ ID ${normalizedText}ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)
        }
        console.log('ğŸ“§ ì´ë©”ì¼ ID ì…ë ¥ë¨:', normalizedText)
        
        // ì™„ì „í•œ ì´ë©”ì¼ ì£¼ì†Œê°€ ì™„ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
        const completeEmail = `${normalizedText}${selectedDomain}`
        console.log('ğŸ“§ ì™„ì„±ëœ ì´ë©”ì¼ ì£¼ì†Œ:', completeEmail)
        
        // ì´ë©”ì¼ ID ì…ë ¥ ì™„ë£Œ (ìë™ ì´ë™ì€ ë³„ë„ useEffectì—ì„œ ì²˜ë¦¬)
        console.log('ğŸ“§ ì´ë©”ì¼ ID ì…ë ¥ë¨:', normalizedText)
        console.log('ğŸ“§ í˜„ì¬ ì„ íƒëœ ë„ë©”ì¸:', selectedDomain)
        console.log('ğŸ“§ ì™„ì„±ëœ ì´ë©”ì¼:', `${normalizedText}${selectedDomain}`)
      }
    } else if (inputMode === 'password') {
      // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
      if (passwordMode) {
        const passwordText = transcript.trim()
        setPassword(passwordText)
        // ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” TTS ìµœì†Œí™”
        if (!isListening) {
          speak('ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.')
        }
        console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ë¨:', passwordText)
        
        // ë¹„ë°€ë²ˆí˜¸ê°€ ì¶©ë¶„í•œ ê¸¸ì´(ìµœì†Œ 4ì)ì´ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
        if (passwordText.length >= 4) {
          setTimeout(() => {
            setPasswordMode(false)
            focusAndStartSTT(confirmPasswordRef, 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
            console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì™„ë£Œ - ìë™ìœ¼ë¡œ í™•ì¸ ëª¨ë“œë¡œ ì´ë™')
          }, 1000) // 1ì´ˆ í›„ ìë™ ì´ë™
        } else {
          console.log('â³ ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ë¶€ì¡± - ì¶”ê°€ ì…ë ¥ ëŒ€ê¸°')
        }
      } else {
        const confirmPasswordText = transcript.trim()
        setConfirmPassword(confirmPasswordText)
        // ìŒì„± ì¸ì‹ ì¤‘ì—ëŠ” TTS ìµœì†Œí™”
        if (!isListening) {
          speak('í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.')
        }
        console.log('ğŸ” í™•ì¸ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ë¨:', confirmPasswordText)
        
        // ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ê³  ì¶©ë¶„í•œ ê¸¸ì´ì´ë©´ ìë™ìœ¼ë¡œ ê°€ì… ì§„í–‰
        if (password && confirmPasswordText && password === confirmPasswordText && confirmPasswordText.length >= 4) {
          setTimeout(() => {
            if (email && password && confirmPasswordText) {
              speak('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤. ëª¨ë“  ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ì§„í–‰í•©ë‹ˆë‹¤.')
              console.log('ğŸš€ ëª¨ë“  ì •ë³´ ì…ë ¥ ì™„ë£Œ - ìë™ìœ¼ë¡œ íšŒì›ê°€ì… ì§„í–‰')
              const submitEvent = new Event('submit') as any
              handleSubmit(submitEvent)
            } else {
              speak('ì…ë ¥ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.')
              console.log('âš ï¸ ì…ë ¥ ì •ë³´ ëˆ„ë½ - ê°€ì… ì§„í–‰ ë¶ˆê°€')
            }
          }, 1500) // 1.5ì´ˆ í›„ ìë™ ê°€ì…
        } else if (password && confirmPasswordText && password !== confirmPasswordText) {
          speak('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.')
          console.log('âŒ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜ - ì¬ì…ë ¥ í•„ìš”')
        } else {
          console.log('â³ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê¸¸ì´ ë¶€ì¡± - ì¶”ê°€ ì…ë ¥ ëŒ€ê¸°')
        }
      }
    }
    
    resetTranscript()
  }, [transcript, isListening, speak, resetTranscript, inputMode, passwordMode, voiceError])

      // ë„ë©”ì¸ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™
    useEffect(() => {
      // ë„ë©”ì¸ì´ ì„ íƒë˜ê³  ì´ë©”ì¼ IDê°€ ìˆìœ¼ë©´ ë°”ë¡œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™
      if (inputMode === 'email' && 
          emailId && 
          emailId.trim() && 
          selectedDomain && 
          selectedDomain !== '@gmail.com') {
        
        console.log('ğŸŒ ë„ë©”ì¸ ì„ íƒ ê°ì§€ - ìë™ ì´ë™ ì¤€ë¹„')
        console.log('ğŸ“§ ì´ë©”ì¼ ID:', emailId)
        console.log('ğŸ“§ ì„ íƒëœ ë„ë©”ì¸:', selectedDomain)
        console.log('ğŸ“§ ì™„ì„±ëœ ì´ë©”ì¼:', `${emailId}${selectedDomain}`)
        
        // 1ì´ˆ í›„ ìë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™
        const timer = setTimeout(() => {
          setInputMode('password')
          setPasswordMode(true)
          focusAndStartSTT(passwordRef, 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
          console.log('ğŸ” ë„ë©”ì¸ ì„ íƒ ì™„ë£Œ - ìë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™')
        }, 1000)
        
        return () => clearTimeout(timer)
      }
    }, [selectedDomain, inputMode, focusAndStartSTT, passwordRef])

    // ë¹„ë°€ë²ˆí˜¸ ì™„ì„± ì‹œ ìë™ìœ¼ë¡œ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ë¡œ ì´ë™
    useEffect(() => {
      // ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œì´ê³  ë¹„ë°€ë²ˆí˜¸ê°€ 4ì ì´ìƒì´ë©´ ìë™ìœ¼ë¡œ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ë¡œ ì´ë™
      if (inputMode === 'password' && 
          passwordMode && 
          password && 
          password.length >= 4) {
        
        console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ì™„ì„± ê°ì§€ - ìë™ ì´ë™ ì¤€ë¹„')
        console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸:', password)
        console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´:', password.length)
        
        // 1ì´ˆ í›„ ìë™ìœ¼ë¡œ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™
        const timer = setTimeout(() => {
          setInputMode('confirmPassword')
          setPasswordMode(false)
          focusAndStartSTT(confirmPasswordRef, 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.')
          console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ì™„ì„± - ìë™ìœ¼ë¡œ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™')
        }, 1000)
        
        return () => clearTimeout(timer)
      }
    }, [password, inputMode, passwordMode, focusAndStartSTT, confirmPasswordRef])

    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ íšŒì›ê°€ì… ì§„í–‰
    useEffect(() => {
      // í™•ì¸ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œì´ê³  ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ë©´ ìë™ìœ¼ë¡œ íšŒì›ê°€ì… ì§„í–‰
      if (inputMode === 'confirmPassword' && 
          !passwordMode && 
          password && 
          confirmPassword && 
          password === confirmPassword) {
        
        console.log('âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ ê°ì§€ - ìë™ íšŒì›ê°€ì… ì¤€ë¹„')
        console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸:', password)
        console.log('ğŸ” í™•ì¸ ë¹„ë°€ë²ˆí˜¸:', confirmPassword)
        
        // 1ì´ˆ í›„ ìë™ìœ¼ë¡œ íšŒì›ê°€ì… ì§„í–‰
        const timer = setTimeout(() => {
          speak('ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ì§„í–‰í•©ë‹ˆë‹¤.')
          console.log('ğŸš€ ìë™ íšŒì›ê°€ì… ì§„í–‰')
          const submitEvent = new Event('submit') as any
          handleSubmit(submitEvent)
        }, 1000)
        
        return () => clearTimeout(timer)
      }
    }, [confirmPassword, inputMode, passwordMode, password, handleSubmit])

  // ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ í‘œì‹œ
  useEffect(() => {
    if (voiceError || !transcript || !isListening) {
      return;
    }

    console.log('ğŸ”¤ ì›ë³¸ ì¸ì‹ í…ìŠ¤íŠ¸:', transcript)
    
    // "ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤" í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ ê²½ìš° ë¬´ì‹œ
    if (transcript.includes('ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤') || transcript.includes('ì¢…ë£Œ')) {
      console.log('ğŸ”„ ì¢…ë£Œ ë©”ì‹œì§€ í¬í•¨ëœ í…ìŠ¤íŠ¸ ë¬´ì‹œ:', transcript)
      return
    }
    
    // ìŒì„± ëª…ë ¹ì´ í¬í•¨ëœ ê²½ìš° ì‹¤ì‹œê°„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
    const lowerTranscript = transcript.toLowerCase()
    if (lowerTranscript.includes('gmail') || lowerTranscript.includes('naver') || 
        lowerTranscript.includes('daum') || lowerTranscript.includes('yahoo') || 
        lowerTranscript.includes('hotmail') || lowerTranscript.includes('outlook') ||
        lowerTranscript.includes('ì™„ë£Œ') || lowerTranscript.includes('ë‹¤ì‹œ') || 
        lowerTranscript.includes('ë„ì›€ë§') || lowerTranscript.includes('ë¹„ë°€ë²ˆí˜¸') ||
        lowerTranscript.includes('í™•ì¸') || lowerTranscript.includes('ê°€ì…') || 
        lowerTranscript.includes('ì·¨ì†Œ') || lowerTranscript.includes('ì´ë©”ì¼') ||
        lowerTranscript.includes('ì•„ì´ë””')) {
      console.log('ğŸ”„ ëª…ë ¹ì–´ í¬í•¨ëœ í…ìŠ¤íŠ¸ ì‹¤ì‹œê°„ í‘œì‹œ ì•ˆí•¨:', transcript)
      return
    }
    
    // í˜„ì¬ í™œì„±í™”ëœ ì…ë ¥ì°½ì— ë”°ë¼ ì‹¤ì‹œê°„ í‘œì‹œ
    if (inputMode === 'email') {
      // ì´ë©”ì¼ ID ì…ë ¥ì°½ì— ì‹¤ì‹œê°„ í‘œì‹œ
      const normalizedText = normalizeEmailId(transcript)
      console.log('ğŸ”¤ ì‹¤ì‹œê°„ ì •ê·œí™”ëœ í…ìŠ¤íŠ¸:', normalizedText)
      
      // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
      if (normalizedText === lastProcessedText) {
        console.log('ğŸ”„ ì¤‘ë³µ í…ìŠ¤íŠ¸ ë¬´ì‹œ:', normalizedText)
        return
      }
      
      // ì •ê·œí™”ëœ í…ìŠ¤íŠ¸ê°€ ìˆê³ , @ê°€ í¬í•¨ë˜ì§€ ì•Šì€ ê²½ìš° IDë¡œ ì²˜ë¦¬
      if (normalizedText && normalizedText.trim() && !normalizedText.includes('@')) {
        setEmailId(normalizedText)
        setLastProcessedText(normalizedText)
        console.log('ğŸ“§ ì‹¤ì‹œê°„ ì´ë©”ì¼ ID ì—…ë°ì´íŠ¸:', normalizedText)
      } else if (transcript.trim() && !transcript.includes('@')) {
        // ì •ê·œí™”ê°€ ì‹¤íŒ¨í–ˆì§€ë§Œ ì›ë³¸ í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš° ì›ë³¸ ì‚¬ìš©
        setEmailId(transcript.trim())
        setLastProcessedText(transcript.trim())
        console.log('ğŸ“§ ì›ë³¸ í…ìŠ¤íŠ¸ë¡œ ì´ë©”ì¼ ID ì—…ë°ì´íŠ¸:', transcript.trim())
      }
    } else if (inputMode === 'password') {
      // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì— ì‹¤ì‹œê°„ í‘œì‹œ
      if (passwordMode) {
        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì¤‘
        setPassword(transcript.trim())
        console.log('ğŸ” ì‹¤ì‹œê°„ ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸:', transcript.trim())
      } else {
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ ì¤‘
        setConfirmPassword(transcript.trim())
        console.log('ğŸ” ì‹¤ì‹œê°„ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì—…ë°ì´íŠ¸:', transcript.trim())
      }
    } else if (inputMode === 'confirmPassword') {
      // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì°½ì— ì‹¤ì‹œê°„ í‘œì‹œ
      setConfirmPassword(transcript.trim())
      console.log('ğŸ” ì‹¤ì‹œê°„ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì—…ë°ì´íŠ¸ (confirmPassword ëª¨ë“œ):', transcript.trim())
    }
  }, [transcript, isListening, lastProcessedText, inputMode, voiceError])

  // ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as Element
      if (!target.closest('.domain-dropdown')) {
        setShowDomainDropdown(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [])

  // Google ë¡œê·¸ì¸ ì²˜ë¦¬
  const handleGoogleLogin = async () => {
    setLoading(true)
    setError('')
    
    const result = await loginWithGoogle()
    if (result.success) {
      navigate('/home')
    } else {
      setError(result.error)
    }
    setLoading(false)
  }

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
      <div className="max-w-md w-full">
        <div className="card">
          {/* ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ */}
          <div className="mb-4">
            <button
              onClick={() => navigate('/')}
              className="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
            >
              <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
              </svg>
              ìŠ¤íƒ€íŠ¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
          </div>
          
          <div className="text-center mb-8">
            {selectedCountryDomain && (
              <div className="mb-4 p-3 bg-blue-100 rounded-lg">
                <p className="text-blue-800 font-medium">
                  ğŸ¯ ì„ íƒëœ ì§€ì—­: {countryName}
                </p>
              </div>
            )}
            <h1 className="text-3xl font-bold text-gray-900 mb-2">ì•¼ê³  ìŠ¤í¬ì¸ </h1>
            <p className="text-gray-600">íšŒì›ê°€ì…í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”</p>
          </div>

          {/* ìŒì„± ì¸ì‹ ìƒíƒœ í‘œì‹œ */}
          <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-2">
                <div className={`w-3 h-3 rounded-full ${voiceError ? 'bg-gray-400' : isListening ? 'bg-red-500 animate-pulse' : 'bg-gray-400'}`}></div>
                <span className="text-sm text-gray-700">
                  {voiceError 
                    ? 'ìŒì„± ê¸°ëŠ¥ ì‚¬ìš© ë¶ˆê°€' 
                    : isListening 
                    ? `ìŒì„± ì¸ì‹ ì¤‘... (${inputMode === 'email' ? 'ì´ë©”ì¼' : 'ë¹„ë°€ë²ˆí˜¸'} ëª¨ë“œ)` 
                    : 'ìŒì„± ì¸ì‹ ëŒ€ê¸° ì¤‘'
                  }
                </span>
              </div>
              <button
                type="button"
                onClick={(e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  
                  // ì¤‘ë³µ í´ë¦­ ë°©ì§€
                  const currentTime = Date.now();
                  if (lastProcessedTime.current && currentTime - lastProcessedTime.current < 2000) {
                    console.log('ğŸ”„ ì‹œì‘ ë²„íŠ¼ ì¤‘ë³µ í´ë¦­ ë°©ì§€');
                    return;
                  }
                  lastProcessedTime.current = currentTime;
                  
                  console.log('ğŸ¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ!');
                  console.log('ğŸ¤ voiceError ìƒíƒœ:', voiceError);
                  console.log('ğŸ¤ useSpeechRecognition:', !!useSpeechRecognition);
                  console.log('ğŸ¤ useSpeechSynthesis:', !!useSpeechSynthesis);
                  console.log('ğŸ¤ speechError:', speechError);
                  
                  if (voiceError) {
                    console.log('ğŸ¤ ìŒì„± ê¸°ëŠ¥ ì‚¬ìš© ë¶ˆê°€');
                    alert('ìŒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                  }

                  console.log('ğŸ¤ ì‹œì‘ ë²„íŠ¼ í´ë¦­ë¨')
                  console.log('ğŸ¤ í˜„ì¬ isListening:', isListening)
                  console.log('ğŸ¤ í˜„ì¬ inputMode:', inputMode)
                  console.log('ğŸ¤ startListening í•¨ìˆ˜:', !!startListening)
                  console.log('ğŸ¤ stopListening í•¨ìˆ˜:', !!stopListening)
                  
                  if (isListening) {
                    console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì¤‘ì§€ ì‹œë„')
                    stopListening()
                  } else {
                    console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì‹œì‘ ì‹œë„')
                    // ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ì‹œ í˜„ì¬ ì…ë ¥ ëª¨ë“œ ìœ ì§€ (ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)
                    console.log('ğŸ¤ í˜„ì¬ ì…ë ¥ ëª¨ë“œ ìœ ì§€:', inputMode)
                    
                    // ìŒì„± ì¸ì‹ ì‹œì‘ ì „ì— TTS ì•ˆë‚´ (ìµœì†Œí™”)
                    if (!isListening) {
                      speak('ìŒì„± ì¸ì‹ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ë“±ì˜ ëª…ë ¹ì„ ë§ì”€í•´ì£¼ì„¸ìš”.');
                    }
                    
                    setTimeout(() => {
                      startListening()
                      console.log('ğŸ¤ ìŒì„± ì¸ì‹ ì‹¤ì œ ì‹œì‘ë¨')
                    }, 1000);
                  }
                }}
                disabled={voiceError}
                className={`px-3 py-1 text-sm rounded transition-colors cursor-pointer relative z-10 ${
                  voiceError 
                    ? 'bg-gray-400 text-white cursor-not-allowed' 
                    : 'bg-blue-500 text-white hover:bg-blue-600'
                }`}
                style={{ 
                  pointerEvents: voiceError ? 'none' : 'auto',
                  zIndex: 1000
                }}
              >
                {voiceError ? 'ì‚¬ìš© ë¶ˆê°€' : isListening ? 'ì¤‘ì§€' : 'ì‹œì‘'}
              </button>
            </div>
          </div>

          {/* ìŒì„± ëª…ë ¹ ì•ˆë‚´ */}
          <div className="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
            <h3 className="text-sm font-medium text-gray-700 mb-2">ğŸ¤ ìŒì„± ëª…ë ¹ ì‚¬ìš©ë²•</h3>
            <div className="text-xs text-gray-600 space-y-1">
              <p><strong>ìë™ ì§„í–‰:</strong> ì´ë©”ì¼ ì™„ì„± â†’ ë¹„ë°€ë²ˆí˜¸(4ìâ†‘) â†’ í™•ì¸(ì¼ì¹˜) â†’ ìë™ ê°€ì…</p>
              <p><strong>ë„ë©”ì¸:</strong> "gmail", "naver", "daum", "yahoo", "hanmail" (ìŒì„±ìœ¼ë¡œ ì„ íƒ)</p>
              <p><strong>ìˆ˜ë™ ì œì–´:</strong> "ë‹¤ìŒ", "ì™„ë£Œ", "ë‹¤ì‹œ", "ë„ì›€ë§", "ê°€ì…", "ì·¨ì†Œ"</p>
              {voiceError && (
                <p className="text-red-500 mt-2">
                  âš ï¸ ìŒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.
                </p>
              )}
            </div>
          </div>

          <form onSubmit={handleSubmit} className="space-y-6">
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">
                ì´ë©”ì¼
              </label>
              <div className="flex space-x-2">
                {/* ì´ë©”ì¼ ID ì…ë ¥ì°½ */}
                <div className="flex-1">
                  <input
                    ref={emailIdRef}
                    type="text"
                    id="emailId"
                    value={emailId}
                    onChange={(e) => setEmailId(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                    placeholder={isListening ? "ìŒì„± ì¸ì‹ ì¤‘..." : "ì´ë©”ì¼ ID (ìŒì„±ìœ¼ë¡œ ì…ë ¥ ê°€ëŠ¥)"}
                    required
                  />
                </div>
                
                {/* ë„ë©”ì¸ ë“œë¡­ë‹¤ìš´ */}
                <div className="relative domain-dropdown">
                  <button
                    type="button"
                    onClick={() => setShowDomainDropdown(!showDomainDropdown)}
                    className="px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent min-w-[140px]"
                  >
                    {selectedDomain}
                    <span className="ml-2">â–¼</span>
                  </button>
                  
                  {/* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ */}
                  {showDomainDropdown && (
                    <div className="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10">
                      {domains.map((domain) => (
                        <button
                          key={domain}
                          type="button"
                          onClick={() => {
                            setSelectedDomain(domain)
                            setShowDomainDropdown(false)
                          }}
                          className="w-full px-3 py-2 text-left hover:bg-gray-100 focus:bg-gray-100 focus:outline-none"
                        >
                          {domain}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>
              
              {/* ì™„ì„±ëœ ì´ë©”ì¼ í‘œì‹œ */}
              {emailId && (
                <div className="mt-2 text-sm text-gray-600">
                  ì™„ì„±ëœ ì´ë©”ì¼: <span className="font-medium text-primary-600">{email}</span>
                </div>
              )}
              
              {/* ìˆ˜ë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ */}
              {inputMode === 'email' && emailId && emailId.trim() && selectedDomain && 
               selectedDomain !== '@gmail.com' && (
                <div className="mt-2">
                  <button
                    type="button"
                    onClick={() => {
                      setInputMode('password')
                      setPasswordMode(true)
                      focusAndStartSTT(passwordRef, 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.')
                      console.log('ğŸ” ìˆ˜ë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë“œë¡œ ì´ë™')
                    }}
                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                  >
                    ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ìœ¼ë¡œ ì´ë™
                  </button>
                </div>
              )}
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">
                ë¹„ë°€ë²ˆí˜¸
              </label>
              <div className="relative">
                <input
                  ref={passwordRef}
                  type={showPassword ? "text" : "password"}
                  id="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                  placeholder={passwordMode ? "ìŒì„±ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”" : "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"}
                  required
                  minLength={6}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none"
                >
                  {showPassword ? (
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                    </svg>
                  ) : (
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  )}
                </button>
              </div>
            </div>

            <div>
              <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-2">
                ë¹„ë°€ë²ˆí˜¸ í™•ì¸
              </label>
              <div className="relative">
                <input
                  ref={confirmPasswordRef}
                  type={showConfirmPassword ? "text" : "password"}
                  id="confirmPassword"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  className="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                  placeholder={passwordMode ? "ìŒì„±ìœ¼ë¡œ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”" : "ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"}
                  required
                  minLength={6}
                />
                <button
                  type="button"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                  className="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none"
                >
                  {showConfirmPassword ? (
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                    </svg>
                  ) : (
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  )}
                </button>
              </div>
            </div>

            {error && (
              <div className="text-red-600 text-sm text-center">
                {error}
              </div>
            )}

            {speechError && (
              <div className="text-red-600 text-sm text-center">
                ìŒì„± ì¸ì‹ ì˜¤ë¥˜: {speechError}
              </div>
            )}

            {transcript && (
              <div className="text-blue-600 text-sm text-center">
                ì¸ì‹ëœ ìŒì„±: {transcript}
              </div>
            )}

            <button
              type="submit"
              disabled={loading}
              className="w-full bg-primary-500 text-white py-3 px-4 rounded-lg hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {loading ? 'ì²˜ë¦¬ ì¤‘...' : 'íšŒì›ê°€ì…'}
            </button>

            <div className="relative">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300" />
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">ë˜ëŠ”</span>
              </div>
            </div>

            <button
              type="button"
              onClick={handleGoogleLogin}
              disabled={loading}
              className="w-full bg-white text-gray-700 py-3 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2"
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              <span>Googleë¡œ íšŒì›ê°€ì…</span>
            </button>

            <div className="text-center">
              <p className="text-sm text-gray-600">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?{' '}
                <Link to="/login" className="text-primary-500 hover:text-primary-600 font-medium">
                  ë¡œê·¸ì¸í•˜ê¸°
                </Link>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  )
}

export default Register 